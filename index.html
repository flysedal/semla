<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <title>SEMLA OPS CENTER v2.0 [CLASSIFIED]</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        :root {
            --bg-color: #050505;
            --panel-bg: rgba(20, 25, 30, 0.9);
            --text-main: #e0e0e0;
            --accent-cyan: #00f3ff;
            --accent-warn: #ffb700;
            --accent-alert: #ff2a2a;
            --grid-line: rgba(0, 243, 255, 0.1);
            --font-stack: 'Consolas', 'Monaco', monospace;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-main);
            font-family: var(--font-stack);
            margin: 0;
            padding: 10px;
            height: 100vh;
            overflow: hidden;
            background-image: 
                linear-gradient(var(--grid-line) 1px, transparent 1px),
                linear-gradient(90deg, var(--grid-line) 1px, transparent 1px);
            background-size: 40px 40px;
        }

        /* Layout */
        .grid-container {
            display: grid;
            grid-template-columns: 300px 1fr 320px;
            grid-template-rows: 70px 1fr 280px;
            gap: 10px;
            height: calc(100vh - 20px);
        }

        /* Panels */
        .panel {
            background: var(--panel-bg);
            border: 1px solid #333;
            box-shadow: 0 0 15px rgba(0, 243, 255, 0.05);
            position: relative;
            display: flex;
            flex-direction: column;
            backdrop-filter: blur(5px);
        }

        /* Cyber Borders */
        .corner-tl, .corner-tr, .corner-bl, .corner-br {
            position: absolute;
            width: 8px; height: 8px;
            border-color: var(--accent-cyan);
            border-style: solid;
            transition: all 0.3s ease;
        }
        .corner-tl { top: -1px; left: -1px; border-width: 2px 0 0 2px; }
        .corner-tr { top: -1px; right: -1px; border-width: 2px 2px 0 0; }
        .corner-bl { bottom: -1px; left: -1px; border-width: 0 0 2px 2px; }
        .corner-br { bottom: -1px; right: -1px; border-width: 0 2px 2px 0; }

        .panel:hover .corner-tl { width: 100%; height: 100%; opacity: 0.1; background: var(--accent-cyan); }

        /* Headers */
        h2 {
            margin: 0; padding: 10px 15px;
            background: rgba(0, 243, 255, 0.1);
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 2px;
            color: var(--accent-cyan);
            border-bottom: 1px solid rgba(0, 243, 255, 0.2);
            display: flex;
            justify-content: space-between;
        }

        /* Header Bar */
        .top-bar {
            grid-column: 1 / -1;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            border-bottom: 2px solid var(--accent-cyan);
            background: rgba(0,0,0,0.8);
        }
        .main-title {
            font-size: 28px;
            font-weight: 900;
            color: #fff;
            text-shadow: 0 0 10px var(--accent-cyan);
            letter-spacing: 4px;
        }
        .blink { animation: blinker 1.5s linear infinite; color: var(--accent-alert); }
        @keyframes blinker { 50% { opacity: 0; } }

        /* Map Area */
        #map-container {
            grid-column: 2 / 3;
            grid-row: 2 / 3;
            position: relative;
        }
        #map { width: 100%; height: 100%; filter: grayscale(100%) contrast(1.2) brightness(0.8); }
        
        /* Sidebar: Intel */
        .intel-list {
            padding: 10px;
            overflow-y: auto;
            flex-grow: 1;
        }
        .intel-card {
            background: rgba(255,255,255,0.05);
            margin-bottom: 8px;
            padding: 10px;
            border-left: 3px solid #555;
            cursor: pointer;
            transition: 0.2s;
        }
        .intel-card:hover {
            border-left-color: var(--accent-cyan);
            background: rgba(0, 243, 255, 0.1);
        }
        .intel-card.active {
            border-left-color: var(--accent-warn);
            border: 1px solid var(--accent-warn);
        }
        .rank-badge {
            float: right;
            font-weight: bold;
            color: var(--accent-warn);
        }

        /* Search & Filter */
        .controls {
            padding: 10px;
            border-bottom: 1px solid #333;
        }
        input[type="text"] {
            width: 100%;
            background: #111;
            border: 1px solid var(--accent-cyan);
            color: var(--accent-cyan);
            padding: 8px;
            font-family: var(--font-stack);
            text-transform: uppercase;
            box-sizing: border-box;
        }
        .filter-btns {
            display: flex;
            gap: 5px;
            margin-top: 5px;
        }
        .btn {
            flex: 1;
            background: #111;
            border: 1px solid #444;
            color: #888;
            padding: 5px;
            cursor: pointer;
            font-size: 10px;
            text-transform: uppercase;
        }
        .btn.active {
            background: var(--accent-cyan);
            color: #000;
            font-weight: bold;
            border-color: var(--accent-cyan);
        }

        /* Stats & Logs */
        .log-terminal {
            font-size: 11px;
            padding: 10px;
            overflow-y: hidden;
            color: #aaa;
        }
        .log-line { margin-bottom: 4px; border-bottom: 1px solid #222; padding-bottom: 2px;}
        .log-ts { color: var(--accent-cyan); margin-right: 5px; }
        
        /* Popup Styling Override */
        .leaflet-popup-content-wrapper {
            background: rgba(10, 15, 20, 0.95);
            color: #fff;
            border: 1px solid var(--accent-cyan);
            border-radius: 0;
            font-family: var(--font-stack);
        }
        .leaflet-popup-tip { background: var(--accent-cyan); }

        /* Modal for Detail View */
        .detail-view {
            padding: 15px;
            font-size: 13px;
            line-height: 1.5;
        }
        .stat-row { display: flex; justify-content: space-between; border-bottom: 1px dashed #444; margin-bottom: 5px; }
    </style>
</head>
<body>

<div class="grid-container">
    <div class="top-bar panel">
        <div class="main-title">SEMLA OPS CENTER <span style="font-size:12px; color:var(--accent-cyan); vertical-align: middle;">v2.0</span></div>
        <div style="text-align: right; font-size: 12px;">
            <i class="fas fa-satellite-dish"></i> DATA FEED: <span class="blink">LIVE</span><br>
            TARGET AREA: STOCKHOLM PROPER
        </div>
    </div>

    <div class="panel">
        <div class="corner-tl"></div><div class="corner-tr"></div><div class="corner-bl"></div><div class="corner-br"></div>
        <h2><i class="fas fa-crosshairs"></i> TARGET SELECTION</h2>
        
        <div class="controls">
            <input type="text" id="searchInput" placeholder="SEARCH TARGET..." onkeyup="filterList()">
            <div class="filter-btns">
                <button class="btn active" onclick="setFilter('all')">ALL</button>
                <button class="btn" onclick="setFilter('classic')">CLASSIC</button>
                <button class="btn" onclick="setFilter('modern')">MODERN</button>
            </div>
        </div>

        <div class="intel-list" id="bakeryList">
            </div>
    </div>

    <div class="panel" id="map-container">
        <div class="corner-tl"></div><div class="corner-tr"></div><div class="corner-bl"></div><div class="corner-br"></div>
        <div id="map"></div>
        <div style="position: absolute; top: 10px; right: 10px; z-index: 1000; background: rgba(0,0,0,0.7); padding: 5px; border: 1px solid var(--accent-cyan); color: var(--accent-cyan); font-size: 10px;">
            LAT: 59.3293 N <br> LNG: 18.0686 E
        </div>
    </div>

    <div class="panel">
        <div class="corner-tl"></div><div class="corner-tr"></div><div class="corner-bl"></div><div class="corner-br"></div>
        <h2><i class="fas fa-file-contract"></i> TACTICAL INTEL</h2>
        <div id="detailPanel" class="detail-view">
            <p style="color: #666; text-align: center; margin-top: 50px;">> AWAITING TARGET SELECTION <</p>
        </div>
    </div>

    <div class="panel">
        <div class="corner-tl"></div><div class="corner-tr"></div><div class="corner-bl"></div><div class="corner-br"></div>
        <h2><i class="fas fa-server"></i> SUPPLY CHAIN STATUS</h2>
        <div style="padding: 15px; display: flex; align-items: center; justify-content: center; height: 100%;">
            <div style="width: 100px; height: 100px; position: relative;">
                <canvas id="doughnutChart"></canvas>
                <div style="position: absolute; top: 40px; left: 0; width: 100%; text-align: center; font-size: 10px;">
                    STOCK<br>LEVEL
                </div>
            </div>
            <div style="margin-left: 20px; font-size: 12px;">
                <div>MANDELMASSA: <span style="color:var(--accent-cyan)">OPTIMAL</span></div>
                <div style="margin-top:5px;">GRÄDDE: <span style="color:var(--accent-warn)">LOW</span></div>
                <div style="margin-top:5px;">KARDEMUMMA: <span style="color:var(--accent-cyan)">STABLE</span></div>
            </div>
        </div>
    </div>

    <div class="panel">
        <div class="corner-tl"></div><div class="corner-tr"></div><div class="corner-bl"></div><div class="corner-br"></div>
        <h2><i class="fas fa-chart-line"></i> CONSUMPTION RATE (RPM)</h2>
        <div style="height: 100%; padding: 10px;">
            <canvas id="lineChart"></canvas>
        </div>
    </div>

    <div class="panel">
        <div class="corner-tl"></div><div class="corner-tr"></div><div class="corner-bl"></div><div class="corner-br"></div>
        <h2><i class="fas fa-terminal"></i> COMMS LOG</h2>
        <div id="logFeed" class="log-terminal"></div>
    </div>
</div>

<script>
    // --- 1. DATA DATABASE (Verkliga data 2024/2025) ---
    const semlaIntel = [
        { 
            id: 1, 
            name: "Skeppsbro Bageri", 
            lat: 59.3230, lng: 18.0750, 
            type: "modern", 
            rank: "TOP TIER",
            price: "62 SEK",
            verdict: "Vinnarkandidat 2025. Extremt saftig bulle. Ekologisk.",
            intel: "Status: CRITICAL. Hög fuktighet i bullen. Mandelmassan är slät men rik."
        },
        { 
            id: 2, 
            name: "Lillebrors Bageri", 
            lat: 59.3400, lng: 18.0370, 
            type: "modern", 
            rank: "#1 CROWD",
            price: "58 SEK",
            verdict: "Publikfavorit. Alltid lång kö. Grovhackad mandel.",
            intel: "Kö-varning: Extrem. Känd för sin 'crunchy' mandelmassa med rostade bitar."
        },
        { 
            id: 3, 
            name: "Pesso Bageri", 
            lat: 59.3285, lng: 18.0050, 
            type: "modern", 
            rank: "WINNER 24",
            price: "55 SEK",
            verdict: "Vinnare Thatsup 2024. Perfekt balans.",
            intel: "Högsta betyg för balans mellan grädde och mandel. En taktisk fullträff."
        },
        { 
            id: 4, 
            name: "Tössebageriet", 
            lat: 59.3360, lng: 18.0860, 
            type: "classic", 
            rank: "LEGEND",
            price: "60 SEK",
            verdict: "Klassisk + Semmelwrapens skapare.",
            intel: "Klassisk elegans. Tillhandahåller även wrappen för fältoperationer."
        },
        { 
            id: 5, 
            name: "Svedjan Bageri", 
            lat: 59.3180, lng: 18.0530, 
            type: "modern", 
            rank: "ELITE",
            price: "56 SEK",
            verdict: "Otroligt fluffig bulle. Högt betyg i tester.",
            intel: "Bullens densitet är minimal (mycket luftig). Mandelmassan innehåller bittermandel."
        },
        { 
            id: 6, 
            name: "Vete-Katten", 
            lat: 59.3330, lng: 18.0560, 
            type: "classic", 
            rank: "STANDARD",
            price: "58 SEK",
            verdict: "Turistvänlig. Pålitlig. Väldigt klassisk.",
            intel: "Hög kapacitet. Kan hantera stora volymer. Standardkonfiguration."
        },
        { 
            id: 7, 
            name: "Ritorno", 
            lat: 59.3405, lng: 18.0465, 
            type: "classic", 
            rank: "VETERAN",
            price: "58 SEK",
            verdict: "En av stans bästa klassiska semlor.",
            intel: "Inga konstigheter. Ren prestanda. Tung grädde."
        },
        { 
            id: 8, 
            name: "Mr Cake", 
            lat: 59.3420, lng: 18.0650, 
            type: "classic", // Fusion egentligen men filter logic...
            rank: "HEAVY",
            price: "65 SEK",
            verdict: "Amerikansk stil. Sötare, tyngre. Cronuts.",
            intel: "Varning: Hög sockerhalt. Endast för erfarna operatörer."
        },
        { 
            id: 9, 
            name: "Bergstrands", 
            lat: 59.3430, lng: 18.0490, 
            type: "modern",
            rank: "HIGH",
            price: "54 SEK",
            verdict: "Vasastans stolthet. Höga poäng 2024/25.",
            intel: "Robust konstruktion. Utmärkt mandelmassa."
        }
    ];

    // --- 2. KARTA & UI LOGIK ---
    const map = L.map('map', {
        zoomControl: false,
        attributionControl: false
    }).setView([59.33, 18.06], 13);

    L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
        maxZoom: 19
    }).addTo(map);

    let markers = {};

    function initMap() {
        semlaIntel.forEach(target => {
            // Skapa anpassad ikon
            const color = target.rank.includes("WINNER") || target.rank.includes("TOP") ? "#ffb700" : "#00f3ff";
            const iconHtml = `<div style="
                width: 12px; height: 12px; 
                background: ${color}; 
                border: 2px solid #000; 
                transform: rotate(45deg); 
                box-shadow: 0 0 10px ${color};">
                </div>`;
            
            const icon = L.divIcon({
                className: 'custom-marker',
                html: iconHtml,
                iconSize: [16, 16],
                iconAnchor: [8, 8]
            });

            const marker = L.marker([target.lat, target.lng], {icon: icon})
                .addTo(map)
                .bindPopup(`<b>${target.name}</b><br>${target.rank}`);
            
            marker.on('click', () => showDetails(target));
            markers[target.id] = marker;
        });
    }

    function renderList(filter = 'all') {
        const list = document.getElementById('bakeryList');
        list.innerHTML = '';
        const search = document.getElementById('searchInput').value.toLowerCase();

        semlaIntel.forEach(target => {
            if (filter !== 'all' && target.type !== filter) return;
            if (!target.name.toLowerCase().includes(search)) return;

            const div = document.createElement('div');
            div.className = 'intel-card';
            div.innerHTML = `
                <span class="rank-badge">${target.rank}</span>
                <div style="font-weight:bold; color:var(--accent-cyan)">${target.name}</div>
                <div style="font-size:10px; color:#888;">${target.verdict.substring(0, 30)}...</div>
            `;
            div.onclick = () => {
                map.flyTo([target.lat, target.lng], 15);
                markers[target.id].openPopup();
                showDetails(target);
            };
            list.appendChild(div);
        });
    }

    function showDetails(target) {
        const panel = document.getElementById('detailPanel');
        panel.innerHTML = `
            <h3 style="color:var(--accent-cyan); border-bottom:1px solid #333; padding-bottom:5px;">${target.name}</h3>
            <div class="stat-row"><span>KLASS:</span> <span>${target.type.toUpperCase()}</span></div>
            <div class="stat-row"><span>PRIS:</span> <span>${target.price}</span></div>
            <div class="stat-row"><span>RANKING:</span> <span style="color:var(--accent-warn)">${target.rank}</span></div>
            
            <br>
            <strong style="color:var(--accent-cyan)">>>> ANALYS:</strong>
            <p>${target.verdict}</p>
            
            <div style="background:rgba(0,0,0,0.3); padding:10px; border-left:2px solid var(--accent-alert); margin-top:10px; font-family:'Courier New'">
                <strong>INTEL:</strong> ${target.intel}
            </div>
            
            <button onclick="alert('Simulerar beställning till driftcentralen...')" style="width:100%; margin-top:20px; background:var(--accent-cyan); border:none; padding:10px; font-weight:bold; cursor:pointer;">INITIATE ACQUISITION</button>
        `;
        
        // Markera aktiv i listan
        document.querySelectorAll('.intel-card').forEach(el => el.classList.remove('active'));
    }

    function filterList() {
        renderList(currentFilter);
    }

    let currentFilter = 'all';
    function setFilter(type) {
        currentFilter = type;
        document.querySelectorAll('.filter-btns .btn').forEach(b => b.classList.remove('active'));
        event.target.classList.add('active');
        renderList(type);
    }

    // --- 3. CHARTS & LOGS (Visual Candy) ---
    
    // Line Chart (Consumption)
    const ctxLine = document.getElementById('lineChart').getContext('2d');
    new Chart(ctxLine, {
        type: 'line',
        data: {
            labels: Array(10).fill(''),
            datasets: [{
                label: 'RPM',
                data: [45, 49, 52, 48, 55, 60, 58, 62, 65, 63],
                borderColor: '#00f3ff',
                backgroundColor: 'rgba(0, 243, 255, 0.1)',
                fill: true,
                tension: 0.4,
                pointRadius: 0
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { display: false } },
            scales: { x: { display: false }, y: { display: true, grid: { color: '#222' } } },
            animation: { duration: 2000 }
        }
    });

    // Doughnut (Supply)
    const ctxDoughnut = document.getElementById('doughnutChart').getContext('2d');
    new Chart(ctxDoughnut, {
        type: 'doughnut',
        data: {
            labels: ['Stock', 'Consumed'],
            datasets: [{
                data: [75, 25],
                backgroundColor: ['#00f3ff', '#111'],
                borderWidth: 0
            }]
        },
        options: { cutout: '70%', responsive: true, plugins: { legend: { display: false } } }
    });

    // Log Feed
    const logs = [
        "Skeppsbro: Hetvägg protocol initiated",
        "Lillebrors: Queue length exceeding 15m",
        "Drone surveillance: Tösse stock low",
        "System: Calibrating almond sensors",
        "User 01: Requesting location data",
        "Alert: Coffee supply critical"
    ];

    function updateLog() {
        const feed = document.getElementById('logFeed');
        const msg = logs[Math.floor(Math.random() * logs.length)];
        const time = new Date().toLocaleTimeString('sv-SE');
        const div = document.createElement('div');
        div.className = 'log-line';
        div.innerHTML = `<span class="log-ts">[${time}]</span> ${msg}`;
        feed.prepend(div);
        if(feed.children.length > 8) feed.lastChild.remove();
    }
    setInterval(updateLog, 2500);

    // Init
    initMap();
    renderList();

</script>
</body>
</html>
